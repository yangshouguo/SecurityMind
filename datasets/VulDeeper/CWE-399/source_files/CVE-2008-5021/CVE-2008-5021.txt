diff -u -8 -p -r1.156.2.18 nsXMLHttpRequest.cpp
--- a/content/base/src/nsXMLHttpRequest.cpp	7 Oct 2008 16:23:41 -0000	1.156.2.18
+++ b/content/base/src/nsXMLHttpRequest.cpp	15 Oct 2008 11:45:02 -0000
@@ -874,16 +874,19 @@ nsXMLHttpRequest::NotifyEventListeners(n
   if (aHandler) {
     aHandler->HandleEvent(aEvent);
   }
 
   if (aListeners) {
     for (PRInt32 i = 0, i_end = aListeners->Count(); i < i_end; ++i) {
       nsIDOMEventListener *listener = aListeners->ObjectAt(i);
       if (listener) {
+        if (NS_FAILED(CheckInnerWindowCorrectness())) {
+          break;
+        }
         listener->HandleEvent(aEvent);
       }
     }
   }
 
   if (cx) {
     stack->Pop(&cx);
   }
